<!DOCTYPE HTML>
<html>
    <head>
        <title>LAUSD School Finder</title>
        <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
        <script type="text/javascript" src="js/jquery.form.js"></script>
        <script type="text/javascript" src="js/jquery.timers.js"></script>
        <script type="text/javascript" src="js/jquery.dataTables.js"></script>
<style type="text/css">
#buffer {
    width: 640px;
    height: 480px;
}
.col1 {
    float: left;
}
.col2 {
    float: left;
    margin-left: 10px;
}
table {
    border-collapse: collapse; 
    border-spacing: 0;
}
body {
    font-family: arial;
    font-size: 10pt;
}
table { 
    margin: 0 auto; width:500px; clear: both;
}
td {
    font-size: 10pt;
}
#results_length { 
    width: 40%; 
    float: left; 
}
#results_filter {
    width: 50%; 
    float: right; 
    text-align: right;
    clear: right;
}


</style>
<script type="text/javascript">
function _log() {
    if ( eval('typeof console') != 'undefined' ) {
        console.log.apply(this, _log.arguments);
    }
}
String.prototype.trim = function() { 
    return this.replace(/^\s+|\s+$/, '');
}
var addrTable = {};
address = function(num, street, suffix) {
    this.num = num.trim();
    this.street = street.trim();
    this.suffix = suffix.trim();
    this.key = this.num + ' ' + this.street + ' ' + this.suffix;
    this.added = false;
    return this;
}
function updateSearch(text) {
    var pat = /(\d{2,})\s+(.+?)\s+(way|street|blvd|boulevard|ave|place|road|rd|plaza|av|st)/gim;
    var match = null;
    while ((match = pat.exec(text))!=null) {
        var addr = address(match[1], match[2], match[3]);
        if (!(addr.key in addrTable)) {
            addrTable[addr.key] = addr;
            dataTable.fnAddData([addr.key, 'foo']);
        }
    }
    for (key in addrTable) {
        console.log(key);
    }
}
var dataTable = null;
$(function() {
    $('#buffer').everyTime(1500, function(i) {
        var currText = $('#buffer').val();
        if ( currText != $('#prevText').val() ) {
            $('#prevText').val(currText);
            updateSearch(currText);
        }
    });
    dataTable = $('#results').dataTable();
	updateSearch($('#buffer').val());
});
</script>
    </head>
    <body>
        <div class="col1">
            <form>
                <textarea id="buffer"></textarea>
                <input type="hidden" id="prevText"/>
            </form>
        </div>
        <div class="col2">
            <table id="results">
                <thead>
                    <tr><th>Address</th><th>Schools</th></tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </body>
</html>
